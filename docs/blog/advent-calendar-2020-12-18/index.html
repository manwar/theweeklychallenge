<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="The Weekly Challenge - Perl & Raku"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://perlweeklychallenge.org/"/>
    <meta property="og:image"       content="https://perlweeklychallenge.org/images/about/about.jpg"/>
    <meta property="og:description" content="You do not have to be an expert."/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://perlweeklychallenge.org/images/about/about.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Advent Calendar - December 18, 2020.">
    <meta name="author" content="The Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.67.0-DEV" />

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Advent Calendar - December 18, 2020</title>
    <link rel="icon" href="https://perlweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Twitter Bootstrs CSS -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.css">
    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source Code Pro' rel='stylesheet'>
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/main.css">

    <style>
        #goTopButton {
            display: none;          
            position: fixed;        
            bottom: 20px;           
            right: 30px;            
            z-index: 99;            
            border: none;           
            outline: none;          
            background-color: red;  
            color: white;           
            cursor: pointer;        
            padding: 15px;          
            border-radius: 10px;    
            font-size: 18px;        
        }

        #goTopButton:hover {
              background-color: #555;
        }
    </style>


</head>

<body>

<button onclick="goTop()" id="goTopButton" title="Go to top">Top</button>

<script>

    topButton = document.getElementById("goTopButton");

    
    window.onscroll = function() { scrollFunction() };

    function scrollFunction() {
        if (document.body.scrollTop > 40 || document.documentElement.scrollTop > 40) {
            topButton.style.display = "block";
        } else {
            topButton.style.display = "none";
        }
    }

    
    function goTop() {
        document.body.scrollTop = 0; 
        document.documentElement.scrollTop = 0; 
    }

</script>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://perlweeklychallenge.org/">
                        <img src="https://perlweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Advent Calendar - December 18, 2020</h2>
                    <div class="portfolio-meta">
                        <span>Wednesday, Dec 23, 2020</span>|
                        <span> Tags:
                            Raku
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://perlweeklychallenge.org/images/blog/2020-12-18.jpg">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    <p><a href="/blog/advent-calendar-2020"><strong>Advent Calendar 2020</strong></a></p>
<hr>
<p>The gift is presented by <a href="https://perlweeklychallenge.org/blog/meet-the-champion-030"><strong>Kevin Colyer</strong></a>. Today he is talking about his solution to the task <code>Collatz Conjecture</code> of <strong><a href="/blog/perl-weekly-challenge-054">&ldquo;The Weekly Challenge - 054&rdquo;</a></strong>. This is re-produced for <strong>Advent Calendar 2020</strong> from the original <a href="https://kevincolyer.wordpress.com/2020/04/05/perl-weekly-challenge-week-54/"><strong>post</strong></a> by <strong>Kevin Colyer</strong>.</p>
<hr>
<p>This week on the <a href="https://perlweeklychallenge.org/">Perl Weekly Challenges</a> I was working on the two tasks for <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-054/">challenge 54</a>. The first challenge was simple in Raku (formerly Perl 6), a one liner, but the second challenge was about creating a favourite sequence of mine, the Collatz Conjecture. I thought I would block about this as the extra part to the task was computationally intensive and my solution took just 10 seconds to calculate the 1 million steps; Raku is not yet known for speed! (I tested this on my Lenovo X260 laptop)</p>
<h1 id="collatz-conjecture">Collatz Conjecture</h1>
<p>It is thought that the following sequence will always reach 1:</p>
<ul>
<li><code>$n =   $n / 2</code> when <code>$n</code> is even</li>
<li><code>$n = 3*$n + 1</code> when <code>$n</code> is odd</li>
</ul>
<p>For example, if we start at <strong>23</strong>, we get the following sequence:</p>
<p>23 → 70 → 35 → 106 → 53 → 160 → 80 → 40 → 20 → 10 → 5 → 16 → 8 → 4 → 2 → 1</p>
<p>Write a function that finds the <strong>Collatz</strong> sequence for any positive integer. Notice how the sequence itself may go far above the original starting number.</p>
<h2 id="extra-credit">Extra Credit</h2>
<p>Have your script calculate the sequence length for all starting numbers up to 1000000 (1e6), and output the starting number and sequence length for the longest 20 sequences.</p>
<hr>
<h1 id="solution">Solution</h1>
<p>The first part is relatively easy you take your starting number, test it as odd or even and then perform a simple computation on it and repeat until the number reaches 1. It is a very simple algorithm.</p>
<p>The <code>sub collatzSeqChain</code> implements the basic algorithm and returns the sequence it build up bit by bit.</p>
<p>I have specified the type of as many variables as possible as this (I hope!) enables the compiler to use more specific and faster code to implement the sub. Although in my case I am not intending to call this sub repeatedly as that would be too slow. At (1) I used a bit shift operator to do a quick divide by two and one the line before used a bitwise AND to check the lowest bit to determine oddness and evenness. No idea if this is quicker but could be! This completes the first part of the challenge and I used a couple of <code>multi MAIN‘s</code> as multiple entry points to test or to print any sequence for a given number.</p>
<p>(1) I used the same idea in the second <code>sub collatzSeqLen</code>. This sub is for the more demanding part of the challenge. To calculate a million sequences is going to take a long time, especially if I used the first sub and called that over and  over. The Collatz sequence has a property in that higher numbers sometimes have the chains of lower numbers embedded in them. This means I could cache the sequence length as we go. I saw no need to cache the whole length, after all I only needed the 20 longest ones. So I planned to make a sliding index of the longest chains and the number that produced it, then at the end print the sequences anyway.</p>
<p>(2) I used a an array <code>@length</code> to cache the lengths of the chains. This will grow to about 1 million entries, but as I gave it a type, hopefully this will allow the compiler to do this smartly and quickly. A state variable saves me cluttering up the program with a global variable as this is the only part that needs it anyway.</p>
<p>(3) As we are looping through the sequence if we find a filled entry, at the value of it’s chain to our current length and end the loop – we are done as we know will will reach 1.</p>
<p>(4) We know the length of the chain so cache it in <code>@length</code> for the next run.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl6" data-lang="perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">collatzSeqChain</span>(Int $n is copy) {
    <span style="color:#66d9ef">my</span> Str $seq <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;$n&#34;</span>;
    <span style="color:#66d9ef">while</span> $n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> {
        <span style="color:#66d9ef">if</span> $n <span style="color:#f92672">+&amp;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
            $n<span style="color:#f92672">=</span> $n <span style="color:#f92672">+&gt;</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e"># (1)</span>
        } <span style="color:#66d9ef">else</span> {
            $n <span style="color:#f92672">=</span> $n <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
        }
        $seq <span style="color:#f92672">~=</span> <span style="color:#e6db74">&#34; -&gt; $n&#34;</span>;
    }
    <span style="color:#66d9ef">return</span> $seq;
}


<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">collatzSeqLen</span>(Int $number) returns Int {
    state Int @length; <span style="color:#75715e"># (2)</span>
    <span style="color:#66d9ef">my</span> Int $n<span style="color:#f92672">=</span>$number;
    <span style="color:#66d9ef">my</span> Int $len<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;

    <span style="color:#66d9ef">while</span> $n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> {
        <span style="color:#66d9ef">if</span> @length[$n]:exists {
            $len <span style="color:#f92672">+=</span> @length[$n];
            <span style="color:#66d9ef">last</span>; <span style="color:#75715e"># (3)</span>
        }
        <span style="color:#66d9ef">if</span> $n <span style="color:#f92672">+&amp;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
            $n <span style="color:#f92672">=</span> $n <span style="color:#f92672">+&gt;</span> <span style="color:#ae81ff">1</span>;
        } <span style="color:#66d9ef">else</span> {
            $n <span style="color:#f92672">=</span> $n <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
        }
        $len<span style="color:#f92672">++</span>;
    }
    @length[$number]<span style="color:#f92672">=</span>$len; <span style="color:#75715e"># (4)</span>
    <span style="color:#66d9ef">return</span> $len;
}

multi MAIN(<span style="color:#e6db74">&#39;test&#39;</span>) {
    say collatzSeqChain(<span style="color:#ae81ff">23</span>);
}

multi MAIN(<span style="color:#e6db74">&#39;sequence&#39;</span>, Int :$number<span style="color:#f92672">=</span><span style="color:#ae81ff">23</span> ) {
    die <span style="color:#e6db74">&#34;number must be a positive integer &gt; 1 [$number]&#34;</span> <span style="color:#66d9ef">if</span> $number  number in sequence [$number]<span style="color:#e6db74">&#34; if $want &gt;= $number;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    my Int @chain = 0;
</span><span style="color:#e6db74">    my Int $topMin = 1;
</span><span style="color:#e6db74">    my Int @top;
</span><span style="color:#e6db74">    my Int @topN;
</span><span style="color:#e6db74">    my %ltoi; # (5)
</span><span style="color:#e6db74">    my $t = now.Int; # (6)
</span><span style="color:#e6db74">    my Int $x = $number;
</span><span style="color:#e6db74">    my Int $l;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    for 1..$x -&gt; Int $i {
</span><span style="color:#e6db74">        $l = collatzSeqLen($i);
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        next if $l  $want;
</span><span style="color:#e6db74">        $topMin = @top[0]; # (8)
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    @top.map({ &#34;</span><span style="color:#f92672">\</span>n{%ltoi{$_}} length $_ <span style="color:#f92672">=</span> <span style="color:#f92672">\</span>n<span style="color:#e6db74">&#34;~collatzSeqChain( %ltoi{$_} )  })&gt;&gt;.say; # (9)
</span><span style="color:#e6db74">    say &#34;</span><span style="color:#f92672">\</span>n$x sequences searched in {Rat(now <span style="color:#f92672">-</span>$t)} seconds<span style="color:#960050;background-color:#1e0010">&#34;</span>; <span style="color:#75715e"># (10)</span>
}
</code></pre></div><p>The final MAIN function gives the lengths of the N longest chains. The defaults are sequences up to 1,000,000 and N of 20.</p>
<p>(5) I use a hash <code>%ltoi</code> (length to index) to keep the relations to the longest lengths and the sequence starting point that produces the chain.</p>
<p>(6) This line takes a snapshot of the current time so I can get an idea of how quickly the loop runs. It is paired with comment (10) below</p>
<p>(7) Each time we derive another sequence length we compare it to the minimum length of the top 20 longest sequences. We also check if it is longer that there is not another sequence that long in there. I am not interested in duplicate lengths really. Optional statement really.</p>
<p>(8) I keep an array <code>@top</code> and push the newly found long length in, sort and push out the shortest. The new shortest becomes the minimum value to beat to get into the top 20</p>
<p>(9) A one liner to map over the <code>@top</code> array and generate the report item by item. It is then fed into say to print it. A hyper is required to do this as otherwise I would pass the report as a list. This ensures each item of the list is printed.</p>
<p>(10) The elapsed time is produced. I found I needed to cast this to a Rat to remove the type indication of Instant (for a duration of time)</p>
<p>And that’s it!</p>
<p>I could have increased the speed a little by in-lining the sub. Possibly I could have added multiple processes but this would get a bit messy with the caching but I guess it is possible. Anyway I am happy with 10 seconds run time… What do you think? Did I miss a trick?</p>
<hr>
<p>If you have any suggestion then please do share with us <a href="mailto:perlweeklychallenge@yahoo.com">perlweeklychallenge@yahoo.com</a>.</p>
<p><a href="/blog/advent-calendar-2020"><strong>Advent Calendar 2020</strong></a></p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h2>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->



<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        2020
                    </span> PerlWeeklyChallenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" rel="noreferrer" rel="noreferrer" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" rel="noreferrer" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.nomtimes.co.uk/site/shop.do?cref=PerlBooks" title="Free Perl Books" rel="noreferrer" target="_blank">
                            <img src="/images/NomTimes.jpg" style="width:22px; height: 18px;" alt=""/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://perlweeklychallenge.org/plugins/jQurey/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.form.min.js"></script>
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://perlweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://perlweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/chart.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/pwc-challenge.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/gc-challenge.js"></script>
<!-- wow js -->
<script src="https://perlweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://perlweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://perlweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-136524905-1', 'auto');
    ga('send', 'pageview');
</script>
</body>

</html>

