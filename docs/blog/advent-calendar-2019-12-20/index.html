<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="The Weekly Challenge - Perl & Raku"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://perlweeklychallenge.org/"/>
    <meta property="og:image"       content="https://perlweeklychallenge.org/images/about/about.jpg"/>
    <meta property="og:description" content="You do not have to be an expert."/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://perlweeklychallenge.org/images/about/about.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Advent Calendar - December 20, 2019">
    <meta name="author" content="Perl Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.55.0-DEV" />

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Advent Calendar - December 20, 2019</title>
    <link rel="icon" href="https://perlweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Twitter Bootstrs CSS -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.css">
    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/main.css">
</head>

<body>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://perlweeklychallenge.org/">
                        <img src="https://perlweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Advent Calendar - December 20, 2019</h2>
                    <div class="portfolio-meta">
                        <span>Friday, Dec 20, 2019</span>|
                        <span> Tags:
                            Perl, Raku
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://perlweeklychallenge.org/images/blog/2019-12-20.jpg">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    

<p><a href="/blog/advent-calendar-2019"><strong>Advent Calendar 2019</strong></a></p>

<hr />

<p>The gift is presented by <a href="/blog/meet-the-champion-026"><strong>Roger Bell_West</strong></a>. Today he is talking about his solutions to <strong>Task #2: Word Game</strong> of <a href="/blog/perl-weekly-challenge-038"><strong>&ldquo;The Weekly Challenge - 038&rdquo;</strong></a>.</p>

<h4 id="lets-assume-we-have-tiles-as-listed-below-with-an-alphabet-a-z-printed-on-them-each-tile-has-a-value-e-g-a-1-point-b-4-points-etc-you-are-allowed-to-draw-7-tiles-from-the-lot-randomly-then-try-to-form-a-word-using-the-7-tiles-with-maximum-points-altogether-you-don-t-have-to-use-all-the-7-tiles-to-make-a-word-you-should-try-to-use-as-many-tiles-as-possible-to-get-the-maximum-points">Lets assume we have tiles as listed below, with an alphabet (A..Z) printed on them. Each tile has a value, e.g. A (1 point), B (4 points) etc. You are allowed to draw 7 tiles from the lot randomly. Then try to form a word using the 7 tiles with maximum points altogether. You don’t have to use all the 7 tiles to make a word. You should try to use as many tiles as possible to get the maximum points.</h4>

<hr />

<p>The word game problem gives a series of tile counts and values (e.g. 8 A tiles worth 1 point each); the problem is to draw 7 at random, then make the highest-scoring word out of them (not necessarily using all of them).</p>

<h2 id="perl-solution">PERL SOLUTION</h2>

<pre><code class="language-perl">    my $l=7;

    my %tilecount=(
        A =&gt; 8,
        G =&gt; 3,
        I =&gt; 5,
        S =&gt; 7,
        U =&gt; 5,
        X =&gt; 2,
        Z =&gt; 5,
        E =&gt; 9,
        J =&gt; 3,
        L =&gt; 3,
        R =&gt; 3,
        V =&gt; 3,
        Y =&gt; 5,
        F =&gt; 3,
        D =&gt; 3,
        P =&gt; 5,
        W =&gt; 5,
        B =&gt; 5,
        N =&gt; 4,
        T =&gt; 5,
        O =&gt; 3,
        H =&gt; 3,
        M =&gt; 4,
        C =&gt; 4,
        K =&gt; 2,
        Q =&gt; 2,
    );

    my %tilevalue=(
        A =&gt; 1,
        G =&gt; 1,
        I =&gt; 1,
        S =&gt; 1,
        U =&gt; 1,
        X =&gt; 1,
        Z =&gt; 1,
        E =&gt; 2,
        J =&gt; 2,
        L =&gt; 2,
        R =&gt; 2,
        V =&gt; 2,
        Y =&gt; 2,
        F =&gt; 3,
        D =&gt; 3,
        P =&gt; 3,
        W =&gt; 3,
        B =&gt; 4,
        N =&gt; 4,
        T =&gt; 5,
        O =&gt; 5,
        H =&gt; 5,
        M =&gt; 5,
        C =&gt; 5,
        K =&gt; 10,
        Q =&gt; 10,
    );
</code></pre>

<p>For the draw, we turn the <strong>%tilecount hash</strong> into a single long list, shuffle it, and throw away all but the first 7 entries. (shuffle is from <strong>List::Util</strong>)</p>

<pre><code class="language-perl">    my @bag=shuffle map {($_) x $tilecount{$_}} keys %tilecount;
    splice @bag,$l;
</code></pre>

<p>Load a candidate word list. (I used a copy of <a href="https://en.wikipedia.org/wiki/Collins_Scrabble_Words"><strong>SOWPODS</strong></a> I have hanging around, which is my standard reference for word validation problems.) We ignore anything longer than <strong>7 characters</strong>.</p>

<pre><code class="language-perl">    my %w;
    open I,'&lt;','wordlist';
    while (&lt;I&gt;) {
        chomp;
        if (length($_)&lt;=$l) {
            $w{uc($_)}=1;
        }
    }
    close I;
</code></pre>

<p>Set up the accumulators for tracking high-scoring words.</p>

<pre><code class="language-perl">    my $maxscore=0;
    my @maxcandidate;
    my %tried;
</code></pre>

<p>Set up the variables for my permutation generator (I&rsquo;ll be using the <strong>Steinhaus-Johnson-Trotter algorithm</strong> with <strong>Even</strong>&rsquo;s optimisation). <strong>@permute</strong> contains a set of indices into <strong>@bag</strong>.</p>

<p>(There&rsquo;s an obvious alternative approach to the problem, which I&rsquo;ll come back to at the end, but let&rsquo;s stick with the permuter for now.)</p>

<pre><code class="language-perl">    my @permute=(0..$#bag);
    my @dir=(-1) x @permute;
    $dir[0]=0;

    while (1) {
</code></pre>

<p>For each permutation, we build a list <strong>@candidate</strong> consisting of the letters in order. Then we try to validate that as a word. (We also skip over any words we&rsquo;ve seen before, since they may appear multiple times as different candidates get shortened; for example, the permutations <strong>ABCDEFG</strong> and <strong>ABCGEFD</strong> would both produce <strong>ABC</strong> if no longer candidate were valid.)</p>

<pre><code class="language-perl">    my @candidate=map {$bag[$_]} @permute;
    while (@candidate) {
        my $candidate=join('',@candidate);
        if (exists $tried{$candidate}) {
            last;
        }
        $tried{$candidate}=1;
        if (exists $w{$candidate}) {
</code></pre>

<p>If so, we calculate the score, and in a two-stage trick of my own ensure that @maxcandidate contains all of the <strong>highest-scoring</strong> words.</p>

<pre><code class="language-perl">            my $score=sum(map {$tilevalue{$_}} @candidate);
            if ($score &gt; $maxscore) {
                @maxcandidate=();
                $maxscore=$score;
            }
            if ($score == $maxscore) {
                push @maxcandidate,$candidate;
            }
</code></pre>

<p>If that was a valid word, we don&rsquo;t need to look at any shorter words in this permutation; if <strong>ABJURER</strong> is valid, then whether or not <strong>ABJURE</strong> is valid it won&rsquo;t score as many points. (This optimisation wouldn&rsquo;t be true if some letters had negative values. Which might be an interesting variant to Scrabble…)</p>

<pre><code class="language-perl">            last;
        }
</code></pre>

<p>This next bit is the permuter. There are various <strong>CPAN</strong> modules that will do this (most obviously <strong>Algorithm::Permute</strong>), but I felt like writing my own.</p>

<pre><code class="language-perl">        my %find=map {$permute[$_] =&gt; $_} (0..$#permute);
        my $m=$#permute;
        while ($m&gt;=0) {
            my $pos=$find{$m};
            unless ($dir[$pos]==0) {
                if ($m &gt; $permute[$pos+$dir[$pos]]) {
                    my $n=$pos+$dir[$pos];
                    my $nn=$n+$dir[$pos];
                    ($permute[$n],$permute[$pos])=($permute[$pos],$permute[$n]);
                    ($dir[$n],$dir[$pos])=($dir[$pos],$dir[$n]);
                    if ($n==0 || $n==$#permute || $permute[$nn] &gt; $m) {
                        $dir[$n]=0;
                    }
                    foreach my $i (0..$#permute) {
                        if ($i==$n) {
                            next;
                        }
                        if ($permute[$i]&gt;$m) {
                            $dir[$i]=($i&lt;$n)?1:-1;
                        }
                    }
                    last;
                }
            }
            $m--;
        }

        if ($m&lt;0) {
            last;
        }
    }
</code></pre>

<p>Finally, output the list of tiles and the highest scoring words.</p>

<pre><code class="language-perl">    print join('',sort @bag),&quot;\n&quot;;
    print &quot;$maxscore: &quot;,join(' ',sort @maxcandidate),&quot;\n&quot;;
</code></pre>

<h2 id="raku-solution">RAKU SOLUTION</h2>

<p><strong>Raku</strong> is a bit different, because there are useful built-in language features:</p>

<pre><code class="language-perl6">    my $tilecount=(
        'A' =&gt; 8,
        'G' =&gt; 3,
        'I' =&gt; 5,
        'S' =&gt; 7,
        'U' =&gt; 5,
        'X' =&gt; 2,
        'Z' =&gt; 5,
        'E' =&gt; 9,
        'J' =&gt; 3,
        'L' =&gt; 3,
        'R' =&gt; 3,
        'V' =&gt; 3,
        'Y' =&gt; 5,
        'F' =&gt; 3,
        'D' =&gt; 3,
        'P' =&gt; 5,
        'W' =&gt; 5,
        'B' =&gt; 5,
        'N' =&gt; 4,
        'T' =&gt; 5,
        'O' =&gt; 3,
        'H' =&gt; 3,
        'M' =&gt; 4,
        'C' =&gt; 4,
        'K' =&gt; 2,
        'Q' =&gt; 2,
    ).BagHash;

    my %tilevalue=(
        'A' =&gt; 1,
        'G' =&gt; 1,
        'I' =&gt; 1,
        'S' =&gt; 1,
        'U' =&gt; 1,
        'X' =&gt; 1,
        'Z' =&gt; 1,
        'E' =&gt; 2,
        'J' =&gt; 2,
        'L' =&gt; 2,
        'R' =&gt; 2,
        'V' =&gt; 2,
        'Y' =&gt; 2,
        'F' =&gt; 3,
        'D' =&gt; 3,
        'P' =&gt; 3,
        'W' =&gt; 3,
        'B' =&gt; 4,
        'N' =&gt; 4,
        'T' =&gt; 5,
        'O' =&gt; 5,
        'H' =&gt; 5,
        'M' =&gt; 5,
        'C' =&gt; 5,
        'K' =&gt; 10,
        'Q' =&gt; 10,
    );

</code></pre>

<p>The <strong>grab</strong> method on a <strong>BagHash</strong> gives me a series of weighted random picks, without replacement. This is a really handy thing to have; lots of code I write does things a bit like this.</p>

<pre><code class="language-perl6">    my @bag=$tilecount.grab($l);

    my %w;
    my $fh=open :r,'wordlist';
    for $fh.lines {
        if ($_.chars &lt;= $l) {
            %w{$_.uc}=1;
        }
    }
    close $fh;
</code></pre>

<p>Similarly, all that permuting algorithm can be replaced with another core feature:</p>

<pre><code class="language-perl6">
    my $maxscore=0;
    my @maxcandidate;
    my %tried;

    for @bag.permutations -&gt; $n {
        my @candidate=$n.list;
        while (@candidate) {
            my $candidate=join('',@candidate);
            if (%tried{$candidate}:exists) {
                last;
            }
            %tried{$candidate}=1;
            if (%w{$candidate}:exists) {
                my $score=sum(map {%tilevalue{$_}}, @candidate);
                if ($score &gt; $maxscore) {
                    @maxcandidate=();
                    $maxscore=$score;
                }
                if ($score == $maxscore) {
                    @maxcandidate.push($candidate);
                }
                last;
            }
            @candidate.pop;
        }
    }

    print join('',sort @bag),&quot;\n&quot;;
    print &quot;$maxscore: &quot;,join(' ',sort @maxcandidate),&quot;\n&quot;;
</code></pre>

<p>Which is less fun to write than the <strong>SJT permuter</strong> above but also less effort. (Now, if only the startup, loading up all these features that are nice to have but most of which a given program won&rsquo;t use, weren&rsquo;t so slow…)</p>

<h2 id="addendum">ADDENDUM</h2>

<p>The alternative approach is to read each word from the dictionary, see if it can be constructed with the available tiles, and if so score it. I wrote this in <strong>Perl</strong> for the blog post, to see how the performance differed. After constructing the bag:</p>

<pre><code class="language-perl">open I,'&lt;','wordlist';
while (&lt;I&gt;) {
  chomp;
  if (length($_)&lt;=$l) {
    my $candidate=uc($_);
    my @candidate=split '',$candidate;
</code></pre>

<p><strong>%l</strong> holds letter counts. We add one to a value each time the letter occurs in the word, then subtract one each time it occurs in the bag. If any value is positive at the end, it occurred more in the word than it did in the bag, so it&rsquo;s not a word we can make. (This could possibly be optimised a bit by precalculating the hash with the bag values subtracted.)</p>

<pre><code class="language-perl">    my %l;
    map {$l{$_}++} @candidate;
    map {$l{$_}--} @bag;
    if (max(values %l) &gt; 0) {
      next;
    }
</code></pre>

<p>At this point we have a word that can be constructed from the available tiles, so just as before we score it.</p>

<pre><code class="language-perl">
    my $score=sum(map {$tilevalue{$_}} @candidate);
    if ($score &gt; $maxscore) {
      @maxcandidate=();
      $maxscore=$score;
    }
    if ($score == $maxscore) {
      push @maxcandidate,$candidate;
    }
  }
}
close I;
print join('',sort @bag),&quot;\n&quot;;
print &quot;$maxscore: &quot;,join(' ',sort @maxcandidate),&quot;\n&quot;;
</code></pre>

<p>To test it, I used <strong>parallel(1)</strong> to run <strong>800 instances</strong> (thus 8 at a time on my 8-core desktop, a new one being invoked whenever the previous one had finished). This variant took about <strong>34 seconds</strong> to complete all <strong>800</strong>; my original permuter code took about <strong>14</strong>. I suspect that this is because my original code can skip score calculations on many words (see <strong>ABJURE/ABJURER</strong> above); to achieve this with the variant code would require the word list to be ordered appropriately with <strong>ABJURER</strong> before <strong>ABJURE</strong>, which would take time to set up.</p>

<p>The downside, of course, is that I have to hold the valid word list in memory. But <strong>SOWPODS</strong> is <strong>2.6 megabytes</strong>, which isn&rsquo;t a problem for any vaguely non-antique machine.</p>

<hr />

<p>If you have any suggestion then please do share with us <a href="mailto:perlweeklychallenge@yahoo.com">perlweeklychallenge@yahoo.com</a>.</p>

<p><a href="/blog/advent-calendar-2019"><strong>Advent Calendar 2019</strong></a></p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h2>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->



<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        <script>document.write(new Date().getFullYear())</script>
                    </span> PerlWeeklyChallenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.nomtimes.co.uk/site/shop.do?cref=PerlBooks" title="Free Perl Books" target="_blank">
                            <img src="/images/NomTimes.jpg" style="width:22px; height: 18px;" alt=""/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://perlweeklychallenge.org/plugins/jQurey/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.form.js"></script>
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://perlweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://perlweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/chart.js"></script>
<!-- wow js -->
<script src="https://perlweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://perlweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://perlweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-136524905-1', 'auto');
    ga('send', 'pageview');
</script>
</body>

</html>

