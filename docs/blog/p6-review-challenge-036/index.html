<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="The Weekly Challenge - Perl & Raku"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://perlweeklychallenge.org/"/>
    <meta property="og:image"       content="https://perlweeklychallenge.org/images/about/about.jpg"/>
    <meta property="og:description" content="You do not have to be an expert."/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://perlweeklychallenge.org/images/about/about.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Laurent Rosenfeld Weekly Review: Challenge - #036.">
    <meta name="author" content="Perl Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.67.0-DEV" />

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Laurent Rosenfeld Weekly Review: Challenge - 036</title>
    <link rel="icon" href="https://perlweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source Code Pro' rel='stylesheet'>
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/main.css">
</head>

<body>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://perlweeklychallenge.org/">
                        <img src="https://perlweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Laurent Rosenfeld Weekly Review: Challenge - 036</h2>
                    <div class="portfolio-meta">
                        <span>Sunday, Dec 8, 2019</span>|
                        <span> Tags:
                            Raku
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://perlweeklychallenge.org/images/blog/p6-review-challenge-036.jpg">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    <hr>
<h1 id="raku-solutions-weekly-review">Raku Solutions Weekly Review</h1>
<hr>
<h2 id="task-1-vehicle-identification-numbers-vin">Task #1: Vehicle Identification Numbers (VIN)</h2>
<p>This is derived in part from my <a href="http://blogs.perl.org/users/laurent_r/2019/05/perl-weekly-challenge-6-compact-number-ranges.html">blog post</a> made in answer to the <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-036/">Week 36 of the Perl Weekly Challenge</a> organized by  <a href="http://blogs.perl.org/users/mohammad_s_anwar/">Mohammad S. Anwar</a> as well as answers made by others to the same challenge.</p>
<p>The challenge reads as follows:</p>
<p><em>Write a program to validate given Vehicle Identification Number (VIN). For more information, please checkout <a href="https://en.wikipedia.org/wiki/Vehicle_identification_number">wikipedia</a>.</em></p>
<p>From the Wikipedia article, it appears that VINs are made up of 17 digits and upper-case letters, with the exception of letters I (i), O (o) and Q (q), to avoid confusion with numerals 0, 1, and 9. There are some additional rules that only applicable to certain areas of the world but are not internationally recognized.</p>
<h2 id="my-solutions">My Solutions</h2>
<p>We write a simple <code>validate</code> subroutine that returns a true value if the passed parameter complies with the above rules for VINs and a false value otherwise.</p>
<p>In addition, we write a test suite in the Raku <a href="https://docs.raku.org/language/testing">Test</a> framework containing 16 test cases. The <code>ok</code> function is fine for checking if a Boolean value is true; contrary to the Perl 5 <code>Test::More</code> testing framework, the Raku <code>Test</code> framework also has a <code>nok</code> function that makes it possible to test directly a false Boolean value.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">use</span> v6;
<span style="color:#66d9ef">use</span> Test;

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate</span> ($vin) {
    <span style="color:#66d9ef">return</span> False <span style="color:#66d9ef">if</span> $vin <span style="color:#f92672">~~</span> <span style="color:#e6db74">/&lt;[OIQ]&gt;/</span>;
    <span style="color:#66d9ef">return</span> True <span style="color:#66d9ef">if</span> $vin <span style="color:#f92672">~~</span> <span style="color:#e6db74">/^ &lt;[A..Z0..9]&gt; ** 17 $/</span>;
    <span style="color:#66d9ef">return</span> False;
}

plan <span style="color:#ae81ff">16</span>;

ok  validate(<span style="color:#e6db74">&#34;A&#34;</span> x <span style="color:#ae81ff">17</span>),   <span style="color:#e6db74">&#34;17 A&#39;s&#34;</span>;
ok  validate(<span style="color:#ae81ff">1</span> x <span style="color:#ae81ff">17</span>),     <span style="color:#e6db74">&#34;17 digits&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;AEIOU&#34;</span>),    <span style="color:#e6db74">&#34;Five vowels&#34;</span>;
nok validate(<span style="color:#ae81ff">1234567890</span>), <span style="color:#e6db74">&#34;Ten digits&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;1234AEIOU5678901&#34;</span>),   <span style="color:#e6db74">&#34;sixteen digits or letters&#34;</span>;
ok  validate(<span style="color:#e6db74">&#34;12345678901234567&#34;</span>),  <span style="color:#e6db74">&#34;17 digits&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;1234567890123456Q&#34;</span>),  <span style="color:#e6db74">&#34;16 digits and a Q&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;1234567890123456O&#34;</span>),  <span style="color:#e6db74">&#34;16 digits and a O&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;1234567890123456I&#34;</span>),  <span style="color:#e6db74">&#34;16 digits and a I&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;Q1234567890123456&#34;</span>),  <span style="color:#e6db74">&#34;A Q and 16 digits&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;I1234567890123456&#34;</span>),  <span style="color:#e6db74">&#34;An I and 16 digits&#34;</span>;
ok  validate(<span style="color:#e6db74">&#34;ABCD4567890123456&#34;</span>),  <span style="color:#e6db74">&#34;17 digits and letters&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;ABef4567890123456&#34;</span>),  <span style="color:#e6db74">&#34;Digits and some lower case letters&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;ABE?4567890123456&#34;</span>),  <span style="color:#e6db74">&#34;A non alphanumerical character&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;ABCD4567 90123456&#34;</span>),  <span style="color:#e6db74">&#34;A space&#34;</span>;
nok validate(<span style="color:#e6db74">&#34;ABCD45678901234567&#34;</span>), <span style="color:#e6db74">&#34;More than 17 characters&#34;</span>;
</code></pre></div><p>Running the program shows that all test pass:</p>
<pre><code>$ perl6 vin.p6
1..16
ok 1 - 17 A's
ok 2 - 17 digits
ok 3 - Five vowels
ok 4 - Ten digits
ok 5 - sixteen digits or letters
ok 6 - 17 digits
ok 7 - 16 digits and a Q
ok 8 - 16 digits and a O
ok 9 - 16 digits and a I
ok 10 - A Q and 16 digits
ok 11 - An I and 16 digits
ok 12 - 17 digits and letters
ok 13 - Digits and some lower case letters
ok 14 - A non alphanumerical character
ok 15 - A space
ok 16 - More than 17 characters
</code></pre>
<p>In North America, the ninth position in a VIN is a check digit i.e. a number calculated from all other characters. Although this is not explicitly requested in the task, we&rsquo;ll make a second version of our program also verifying the check digit, as a bonus. The <code>check-digit</code> subroutine splits the input string, translates the characters into numbers, multiplies each number by the weight assigned to its rank, sums up all the results, computes the remainder of its division by 11, and replaces the remainder by &ldquo;X&rdquo; if it is found to be 10.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">use</span> v6;

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate</span> (Str $vin) {
    <span style="color:#66d9ef">return</span> False <span style="color:#66d9ef">if</span> $vin <span style="color:#f92672">~~</span> <span style="color:#e6db74">/&lt;[OIQ]&gt;/</span>;
    <span style="color:#66d9ef">return</span> False <span style="color:#66d9ef">unless</span> $vin <span style="color:#f92672">~~</span> <span style="color:#e6db74">/^ &lt;[A..Z0..9]&gt; ** 17 $/</span>;
    <span style="color:#66d9ef">return</span> check<span style="color:#f92672">-</span>digit $vin;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">check</span>-digit (Str $vin) {
    <span style="color:#66d9ef">my</span> %translations <span style="color:#f92672">=</span> A <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>, B <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>, C <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">3</span>, D <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">4</span>, E <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">5</span>, F <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">6</span>, G <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">7</span>, H <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">8</span>,
        J <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>, K <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>, L <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">3</span>, M <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">4</span>, N <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">5</span>, P <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">7</span>, R <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">9</span>, S <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>,
        T <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">3</span>, U <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">4</span>, V <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">5</span>, W <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">6</span>, X <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">7</span>, Y <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">8</span>, Z <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">9</span>;
    %translations{$_} <span style="color:#f92672">=</span> $_ <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>;
    <span style="color:#66d9ef">my</span> @weights <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>;
    <span style="color:#66d9ef">my</span> $i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">my</span> $sum <span style="color:#f92672">=</span> sum map { %translations{$_} <span style="color:#f92672">*</span> @weights[$i<span style="color:#f92672">++</span>]}, $vin<span style="color:#f92672">.</span>comb;
    <span style="color:#66d9ef">my</span> $mod <span style="color:#f92672">=</span> $sum % 11;
    $mod <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;X&#39;</span> <span style="color:#66d9ef">if</span> $mod <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span>;
    <span style="color:#66d9ef">return</span> True <span style="color:#66d9ef">if</span> $mod <span style="color:#f92672">eq</span> substr $vin, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">return</span> False;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">MAIN</span> (Str $vin = &#34;1M8GDM9AXKP042788&#34;) {
    say validate($vin) ?? <span style="color:#e6db74">&#34;Correct&#34;</span> <span style="color:#f92672">!!</span> <span style="color:#e6db74">&#34;Wrong&#34;</span>;
}
</code></pre></div><p>Running the program displays the following output:</p>
<pre><code>$ perl6 vin.p6
Correct

$ perl6 vin.p6 1M8GDM9AXKP042788
Correct

$ perl6 vin.p6 1M8GDM9AXKP042789
Wrong
</code></pre>
<h2 id="alternative-solutions">Alternative Solutions</h2>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/arne-sommer/perl6/ch-1.p6">Arne Sommer</a> provided a 300-line script telling me that, apparently, I must have missed a lot of the rules. Among other things, his code seems to be checking country codes, manufacturer codes (although a number of manufacturers appear to be missing, such as Citroen, Fiat, Renault, Skoda, Seat, Peugeot or several Chinese companies, but this is apparently because the list would have been too long, so Arne decided just to prune some of it) and construction year codes. I can&rsquo;t summarize here such a lengthy piece of code, please follow the link to his code just above (or look as his <a href="https://raku-musings.com/vin-knapsack.html">blog</a>) if you want to know more.</p>
<p>Note that his <code>VINCHAR</code> regex:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> regex VINCHAR { A <span style="color:#f92672">|</span> B <span style="color:#f92672">|</span> C <span style="color:#f92672">|</span> D <span style="color:#f92672">|</span> E <span style="color:#f92672">|</span> F <span style="color:#f92672">|</span> G <span style="color:#f92672">|</span> H <span style="color:#f92672">|</span> J <span style="color:#f92672">|</span> K <span style="color:#f92672">|</span> L <span style="color:#f92672">|</span> M <span style="color:#f92672">|</span> N <span style="color:#f92672">|</span> P <span style="color:#f92672">|</span> R <span style="color:#f92672">|</span> S <span style="color:#f92672">|</span> T <span style="color:#f92672">|</span> U <span style="color:#f92672">|</span> V <span style="color:#f92672">|</span> W <span style="color:#f92672">|</span> X <span style="color:#f92672">|</span> Y <span style="color:#f92672">|</span> Z <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span> };
</code></pre></div><p>might be expressed more conveniently (or, at least, more concisely), with a character class as something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> regex VINCHAR { <span style="color:#f92672">&lt;</span> [A<span style="color:#f92672">..</span>Z0<span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>] <span style="color:#f92672">-</span> [IOQ] <span style="color:#f92672">&gt;</span> };
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/javier-luque/perl6/ch-1.p6">Javier Luque</a> also implemented a lot of rules which I did not know about. This is his main VIN-checking subroutine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">_check</span>-vin(Str $vin) {
    <span style="color:#66d9ef">my</span> $vin_re <span style="color:#f92672">=</span> <span style="color:#e6db74">/&lt;[A..HJ..NPR..Z0..9]&gt;/</span>;

    <span style="color:#75715e"># Check for valid World Vin</span>
    <span style="color:#66d9ef">return</span> Nil <span style="color:#66d9ef">unless</span> ($vin <span style="color:#f92672">~~</span> <span style="color:#f92672">/</span>
        <span style="color:#f92672">^^</span>              <span style="color:#75715e"># Start of string</span>
        ($vin_re <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span>)  <span style="color:#75715e"># World identification number</span>
        ($vin_re <span style="color:#f92672">**</span> <span style="color:#ae81ff">6</span>)  <span style="color:#75715e"># Vehicle descriptor section</span>
        ($vin_re <span style="color:#f92672">**</span> <span style="color:#ae81ff">8</span>)  <span style="color:#75715e"># Vehicle identifier section</span>
        $$              <span style="color:#75715e"># End of string</span>
    <span style="color:#f92672">/</span>);

    <span style="color:#75715e"># Capture parts of the vin</span>
    <span style="color:#66d9ef">my</span> $win <span style="color:#f92672">=</span> $0; <span style="color:#75715e"># World identification number</span>
    <span style="color:#66d9ef">my</span> $vds <span style="color:#f92672">=</span> $1; <span style="color:#75715e"># Vehicle descriptor section</span>
    <span style="color:#66d9ef">my</span> $vis <span style="color:#f92672">=</span> $2; <span style="color:#75715e"># Vehicle identifier section</span>

    <span style="color:#75715e"># 1st digit of the VIS can&#39;t be a U, Z or 0</span>
    <span style="color:#66d9ef">return</span> Nil <span style="color:#66d9ef">if</span> ($vis <span style="color:#f92672">~~</span> <span style="color:#e6db74">/^^&lt;[UZ0]&gt;/</span>);

    <span style="color:#75715e"># Need to validate check digit</span>
    <span style="color:#75715e"># compulsory for vehicles</span>
    <span style="color:#75715e"># in North America and China,</span>
    <span style="color:#66d9ef">if</span> ($win <span style="color:#f92672">~~</span> <span style="color:#e6db74">/^^&lt;[1..5L]&gt;/</span>) {
        <span style="color:#66d9ef">return</span> Nil <span style="color:#66d9ef">unless</span> check<span style="color:#f92672">-</span>digit($vin);
    }

    <span style="color:#75715e"># In america and china the last 5</span>
    <span style="color:#75715e"># digits of the vis is numeric</span>
    <span style="color:#66d9ef">if</span> ($win <span style="color:#f92672">~~</span>  <span style="color:#e6db74">/^^&lt;[1..5L]&gt;/</span>) {
        <span style="color:#66d9ef">return</span> Nil <span style="color:#66d9ef">unless</span> ($vis <span style="color:#f92672">~~</span> <span style="color:#f92672">/</span>
            <span style="color:#f92672">^^</span>             <span style="color:#75715e"># Start of string</span>
            $vin_re <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># First 3</span>
            <span style="color:#f92672">\</span>d  <span style="color:#f92672">**</span> <span style="color:#ae81ff">5</span>       <span style="color:#75715e"># Last 5 digits</span>
            $$             <span style="color:#75715e"># End of string</span>
        <span style="color:#f92672">/</span>);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/daniel-mita/perl6/ch-1.p6">Daniel Mita</a> wrote a small grammar to perform VIN validation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">grammar VIN {
  token TOP  { <span style="color:#e6db74">&lt;WMI&gt;</span> <span style="color:#e6db74">&lt;VDS&gt;</span> <span style="color:#e6db74">&lt;VIS&gt;</span> }
  token WMI  { <span style="color:#e6db74">&lt;.char&gt;</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span> }
  token VDS  { <span style="color:#e6db74">&lt;.char&gt;</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">6</span> }
  token VIS  { <span style="color:#e6db74">&lt;.char&gt;</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">8</span> }
  token char { <span style="color:#f92672">&lt;</span>[A<span style="color:#f92672">..</span>H J<span style="color:#f92672">..</span>N P R<span style="color:#f92672">..</span>Z <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>]<span style="color:#f92672">&gt;</span> }
}
</code></pre></div><p>That&rsquo;s quite nice, but, to tell the truth, since three of the tokens are just a number of <code>char</code> tokens, it seems to me that the grammar may slightly over-engineered, as this grammar:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">grammar VIN {
  token TOP  { <span style="color:#e6db74">&lt;.char&gt;</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">17</span> }
  token char { <span style="color:#f92672">&lt;</span>[A<span style="color:#f92672">..</span>H J<span style="color:#f92672">..</span>N P R<span style="color:#f92672">..</span>Z <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>]<span style="color:#f92672">&gt;</span> }
}
</code></pre></div><p>should presumably yield the same result (unless you intend to do further things with the <code>&lt;WMI&gt;</code>, <code>&lt;VDS&gt;</code>, and <code>&lt;VIS&gt;</code> tokens).</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/kevin-colyer/perl6/ch-1.p6">Kevin Colyer</a>, like me, checks the length of the VIN, also checks that it does not contains invalid letters (I, O, and Q), and it verifies the check digit:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validateVIN</span>($vin is copy) {
    <span style="color:#66d9ef">my</span> @v<span style="color:#f92672">=</span> $vin<span style="color:#f92672">.</span>uc<span style="color:#f92672">.</span>comb;
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;invalid vin character: I,O or Q&#34;</span>     <span style="color:#66d9ef">if</span> $vin <span style="color:#f92672">~~</span> m:i<span style="color:#e6db74">/ &lt;[ I O Q ]&gt;+ /</span>;
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;invalid vin length {$vin.chars}&#34;</span> <span style="color:#66d9ef">if</span> $vin<span style="color:#f92672">.</span>chars <span style="color:#f92672">!=</span> <span style="color:#ae81ff">17</span>;

    <span style="color:#66d9ef">my</span> $check<span style="color:#f92672">=</span>@v[<span style="color:#ae81ff">8</span>];
    $check <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#66d9ef">if</span> $check <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#39;_&#39;</span>;
    $check <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">if</span> $check <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#39;X&#39;</span>;
    <span style="color:#66d9ef">my</span> $i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">17</span> {
        $i <span style="color:#f92672">+=</span> %value{@v[$_]} <span style="color:#f92672">*</span> @weight[$_];
    };

    <span style="color:#66d9ef">return</span> $i % 11 <span style="color:#f92672">==</span> $check ?? <span style="color:#e6db74">&#34;valid&#34;</span> <span style="color:#f92672">!!</span> <span style="color:#e6db74">&#34;invalid - failed checksum&#34;</span> ;
}
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/simon-proctor/perl6/ch-1.p6">Simon Proctor</a> basically checks the same things as Kevin:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">subset ValidVinStr of Str
    where <span style="color:#e6db74">m/^ &lt;[A..Z 0..9] - [IOQ]&gt; ** 9 &lt;[A..Z 0..9] - [IOQUZ0]&gt; &lt;[A..Z 0..9] - [IOQ]&gt; ** 7 $/</span>;

<span style="color:#75715e">#| Validate a North American VIN</span>
<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">MAIN</span> (
    ValidVinStr $vin #= VIN to check
) {
    <span style="color:#66d9ef">my</span> %transliterator <span style="color:#f92672">=</span> ( ( <span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#34;Z&#34;</span> ) Z<span style="color:#f92672">=&gt;</span> ( <span style="color:#f92672">|</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>),<span style="color:#f92672">|</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>),<span style="color:#f92672">|</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>) ) );

    <span style="color:#66d9ef">my</span> @combed <span style="color:#f92672">=</span> $vin<span style="color:#f92672">.</span>comb();
    <span style="color:#66d9ef">my</span> $check <span style="color:#f92672">=</span> @combed[<span style="color:#ae81ff">8</span>];
    <span style="color:#66d9ef">my</span> $calc<span style="color:#f92672">-</span>check <span style="color:#f92672">=</span> ( [<span style="color:#f92672">+</span>] (@combed[<span style="color:#f92672">|</span>(<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">7</span>),<span style="color:#f92672">|</span>(<span style="color:#ae81ff">9</span><span style="color:#f92672">..</span><span style="color:#ae81ff">16</span>)]<span style="color:#f92672">.</span>map( { %transliterator{$_} <span style="color:#e6db74">//</span> $_ } )) Z<span style="color:#f92672">*</span> (<span style="color:#f92672">|</span>(<span style="color:#ae81ff">8</span><span style="color:#f92672">...</span><span style="color:#ae81ff">2</span>),<span style="color:#f92672">|</span>(<span style="color:#ae81ff">10</span><span style="color:#f92672">...</span><span style="color:#ae81ff">2</span>)) ) % 11;
    $calc<span style="color:#f92672">-</span>check <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;X&#34;</span> <span style="color:#66d9ef">if</span> $calc<span style="color:#f92672">-</span>check <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span>;
    say $calc<span style="color:#f92672">-</span>check <span style="color:#f92672">~~</span> $check ?? <span style="color:#e6db74">&#34;Valid VIN $vin&#34;</span> <span style="color:#f92672">!!</span> <span style="color:#e6db74">&#34;Invalid VIN $vin&#34;</span>;
}
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/ulrich-rieke/perl6/ch-1.p6">Ulrich Rieke</a> essentially checked the same things:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate_VIN_number</span>( Str $vincode ) returns Bool {
  <span style="color:#66d9ef">if</span> ( $vincode <span style="color:#f92672">~~</span> <span style="color:#e6db74">/ &#39;I&#39; | &#39;Q&#39; | &#39;O&#39; /</span> ) {
      <span style="color:#66d9ef">return</span> False ;
  }
  <span style="color:#66d9ef">if</span> ( $vincode<span style="color:#f92672">.</span>substr( <span style="color:#ae81ff">9</span> , <span style="color:#ae81ff">1</span> ) <span style="color:#f92672">~~</span> <span style="color:#e6db74">/&lt;[IQOUZ0]&gt;/</span> ) {
      <span style="color:#66d9ef">return</span> False ;
  }
  <span style="color:#66d9ef">if</span> ( $vincode<span style="color:#f92672">.</span>substr( <span style="color:#ae81ff">9</span> , <span style="color:#ae81ff">1</span>) <span style="color:#f92672">!~~</span> <span style="color:#e6db74">/&lt;[A..Y1..9]&gt;/</span> ) {
      <span style="color:#66d9ef">return</span> False ;
  }
  <span style="color:#66d9ef">if</span> ( $vincode <span style="color:#f92672">~~</span> <span style="color:#e6db74">/&lt;[A..Z1..9]-[IOQ]&gt; ** 17/</span> ) {
    <span style="color:#66d9ef">return</span> True ;
  }
  <span style="color:#66d9ef">return</span> True ;
}
</code></pre></div><p>However, his 37-line <code>test_check_digit</code> subroutine seems a bit too complicated to me.</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/jaldhar-h-vyas/perl6/ch-1.p6">Jaldar H. Vyas</a>, on the other hand, made something a little bit too simple in my view, as it doesn&rsquo;t do any check on the forbidden <code>IOQ</code> letters (yet, adding that check would be very simple).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validateVIN</span>(Str $vin) {

    <span style="color:#66d9ef">if</span> ($vin<span style="color:#f92672">.</span>chars <span style="color:#f92672">!=</span> <span style="color:#ae81ff">17</span>) {
        <span style="color:#66d9ef">return</span> False;
    }

    <span style="color:#66d9ef">if</span> $vin <span style="color:#f92672">!~~</span> <span style="color:#f92672">/^</span>
        <span style="color:#e6db74">&lt;alnum&gt;</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span> <span style="color:#75715e"># World Manufacturer Identifier</span>
        <span style="color:#e6db74">&lt;alnum&gt;</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">6</span> <span style="color:#75715e"># Vehicle Descriptor Section</span>
        <span style="color:#e6db74">&lt;alnum&gt;</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">8</span> <span style="color:#75715e"># Vehicle Identifier Section</span>
    $/ {
        <span style="color:#66d9ef">return</span> False;
    }

    <span style="color:#66d9ef">return</span> True;
}
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/roger-bell-west/perl6/ch-1.p6">Roger Bell West</a> made some reasonable sense with the somewhat weird-looking translation table for the check-digit calculation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> %cvalue;
map {%cvalue{$_}<span style="color:#f92672">=</span>$_}, (<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>);
<span style="color:#66d9ef">my</span> $base<span style="color:#f92672">=</span>ord(<span style="color:#e6db74">&#39;A&#39;</span>);
<span style="color:#66d9ef">for</span> (slip(<span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#39;H&#39;</span>),slip(<span style="color:#e6db74">&#39;J&#39;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#39;N&#39;</span>),<span style="color:#e6db74">&#39;P&#39;</span>,<span style="color:#e6db74">&#39;R&#39;</span>) <span style="color:#f92672">-&gt;</span> $char {
  %cvalue{$char}<span style="color:#f92672">=</span>(ord($char)<span style="color:#f92672">-</span>$base)%9<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>;
}
<span style="color:#66d9ef">for</span> (<span style="color:#e6db74">&#39;S&#39;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#39;Z&#39;</span>) <span style="color:#f92672">-&gt;</span> $char {
  %cvalue{$char}<span style="color:#f92672">=</span>(ord($char)<span style="color:#f92672">-</span>$base)%9<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>;
}
<span style="color:#66d9ef">my</span> $valid<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;^&lt;[&#39;</span> <span style="color:#f92672">~</span> join(<span style="color:#e6db74">&#39;&#39;</span>,keys %cvalue) <span style="color:#f92672">~</span> <span style="color:#e6db74">&#39;]&gt;*$&#39;</span>;
</code></pre></div><p>Also notice, on the last line above, how his program cleverly uses the keys of the <code>%cvalue</code> hash to build a <code>$valid</code> regex character class pattern for later use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">unless</span> ($vin <span style="color:#f92672">~~</span> <span style="color:#e6db74">/&lt;$valid&gt;/</span>) {
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$vin contains invalid characters\n&#34;</span>;
    <span style="color:#66d9ef">next</span>;
}
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/ruben-westerberg/perl6/ch-1.p6">Ruben Westerberg</a> made one of the most concise implementations:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> @vins:<span style="color:#f92672">=</span>@<span style="color:#960050;background-color:#1e0010">*</span>ARGS;
<span style="color:#66d9ef">my</span> %keys<span style="color:#f92672">=</span>((<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span> Z <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>),(<span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#34;H&#34;</span> Z <span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">8</span>), (<span style="color:#e6db74">&#34;J&#34;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#34;N&#34;</span> Z <span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">5</span>), <span style="color:#e6db74">&#34;P&#34;</span>,<span style="color:#ae81ff">7</span>, <span style="color:#e6db74">&#34;R&#34;</span>,<span style="color:#ae81ff">9</span>,(<span style="color:#e6db74">&#34;S&#34;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#34;Z&#34;</span> Z <span style="color:#ae81ff">2</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>))<span style="color:#f92672">.</span>flat;
<span style="color:#66d9ef">my</span> @weights<span style="color:#f92672">=</span>((<span style="color:#ae81ff">2</span><span style="color:#f92672">..</span><span style="color:#ae81ff">8</span>)<span style="color:#f92672">.</span>reverse,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">0</span>,(<span style="color:#ae81ff">2</span><span style="color:#f92672">..</span><span style="color:#ae81ff">9</span>)<span style="color:#f92672">.</span>reverse)<span style="color:#f92672">.</span>flat;

<span style="color:#66d9ef">for</span> @vins {
    <span style="color:#66d9ef">my</span> $i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;Testing $_: &#34;</span>;
    <span style="color:#66d9ef">my</span> $result<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;OK&#34;</span>;

    $result <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Invalid digits present&#34;</span> <span style="color:#66d9ef">unless</span> <span style="color:#e6db74">/^&lt;[A..Z]+[0..9]&gt;**17$/</span>;
    $result <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Incorrect length&#34;</span> <span style="color:#66d9ef">if</span> $_<span style="color:#f92672">.</span>chars <span style="color:#f92672">!=</span> <span style="color:#ae81ff">17</span>;

    <span style="color:#66d9ef">if</span> $result <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#34;OK&#34;</span>  {
        <span style="color:#66d9ef">my</span> $check<span style="color:#f92672">=</span>$_<span style="color:#f92672">.</span>comb<span style="color:#f92672">.</span>map({%keys{$_} <span style="color:#f92672">*</span> @weights[$i<span style="color:#f92672">++</span>]})<span style="color:#f92672">.</span>sum % 11;
        $check<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;X&#34;</span> <span style="color:#66d9ef">if</span> $check <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span>;
        $result<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Invalid VIN number&#34;</span> <span style="color:#66d9ef">if</span> $check <span style="color:#f92672">ne</span> $_<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">1</span>);
    }
    put $result;
}
</code></pre></div><p>I especially like the innovative way in which Ruben constructs the <code>%key</code> character-translation hash and the <code>@weights</code> array used for computing the check digit, as well as the way he computes the check digit in just one statement.</p>
<h2 id="task-2-the-knapsack-problem">Task #2: The Knapsack Problem</h2>
<p>The challenge reads as follows:</p>
<p><em>Write a program to solve Knapsack Problem.</em></p>
<p><em>There are 5 color coded boxes with varying weights and amounts in GBP. Which boxes should be chosen to maximize the amount of money while still keeping the overall weight under or equal to 15 kg?</em>
R: (weight = 1 kg, amount = £1)
B: (weight = 1 kg, amount = £2)
G: (weight = 2 kg, amount = £2)
Y: (weight = 12 kg, amount = £4)
P: (weight = 4 kg, amount = £10)</p>
<p><em>Bonus task, what if you were allowed to pick only 2 boxes or 3 boxes or 4 boxes? Find out which combination of boxes is the most optimal?</em></p>
<p>The <em>knapsack problem</em> or <em>rucksack problem</em> is a well-known problem in combinatorial optimization: given a set of items, each with a weight and a value, determine the number of each item to include in a collection so that the total weight is less than or equal to a given limit and the total value is as large as possible. It derives its name from the problem faced by someone who is constrained by a fixed-size knapsack and must fill it with the most valuable items. In this specific case, this is what is sometimes called the <em>0-1 knapsack problem</em>, where you can chose only one of each of the listed items.</p>
<p>I will directly take the &ldquo;bonus&rdquo; version of the problem, as it seems simpler to take this constraint in consideration right from the beginning.</p>
<p>The <em>knapsack problem</em> is known to be a at least an NP-Complete problem (and the optimization problem is NP-Hard). This means that there is no known polynomial algorithm which can tell, given a solution, whether it is optimal. There are, however, some algorithms that can solve the problem in pseudo-polynomial time, using dynamic programming.</p>
<p>However, with a set of only five boxes, we can run a so-called brute-force algorithm, that is try all possible solutions to find the best. A better algorithm would probably be needed to manage 30 or more boxes, but we&rsquo;re given only 5 boxes, and trying to find a better algorithm for only five boxes would be, in my humble view, a case of over-engineering.</p>
<h2 id="my-solutions-1">My Solutions</h2>
<p>To start with, we&rsquo;ll populate a <code>%boxes</code> hash of hashes with the box colors as keys, and their respective weights and values:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">constant %boxes <span style="color:#f92672">=</span> (
    <span style="color:#e6db74">&#34;R&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>,  val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>  },
    <span style="color:#e6db74">&#34;B&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>,  val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>  },
    <span style="color:#e6db74">&#34;G&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>,  val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>  },
    <span style="color:#e6db74">&#34;Y&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">12</span>, val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">4</span>  },
    <span style="color:#e6db74">&#34;P&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">4</span>,  val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">10</span> },
);
<span style="color:#960050;background-color:#1e0010">​</span><span style="color:#e6db74">``</span><span style="color:#960050;background-color:#1e0010">`</span>
</code></pre></div><h3 id="a-recursive-solution">A Recursive Solution</h3>
<p>The most immediate solution to test all boxes combinations would be to use five nested loops, but that&rsquo;s tedious and ugly, and we would need to neutralize some of the loops for satisfying the bonus task with only 2, 3, or 4 boxes. And it doesn&rsquo;t scale: it would break if we were given 6 boxes. I prefer to implement a recursive solution which can work independently of the number of boxes (at least for a start, as this is the idea of the solution I implemented originally for the Perl 5 solution to the challenge, we will see later a simpler solution in Raku).</p>
<p>We want to look at combinations (i.e. subsets of the data where the order in which the boxes are selected doesn&rsquo;t matter) and not permutations (where the order  matters) to avoid doing unnecessary work. To get combinations, we can just retain only permutations that are in a given order, for example in alphabetic order, and filter out the others. One parameter to our recursive subroutine, <code>$last-box-used</code>, enables us to compare each <code>box</code> in the <code>for</code> loop with the previous one and to keep only those where <code>box</code> comes after in the alphabetic order. And we make our first call of the <code>try-one</code>subroutine with a dummy parameter, &ldquo;A&rdquo;, which comes before any of the boxes.</p>
<p>I prefer to implement a recursive solution where the parameters to the recursive <code>try-one</code> subroutine govern the number of loops that will be performed. These parameters are as follows:</p>
<ul>
<li>Current cumulative weight of the selected boxes;</li>
<li>Current total value of the selected boxes;</li>
<li>Maximum number of boxes to be selected (for the bonus)</li>
<li>A string listing the boxes used so far in the current solution;</li>
<li>Name of the last used box (to get only combinations);</li>
<li>A list of the boxes still available;</li>
</ul>
<p>For the first call of <code>try-one</code> recursive subroutine, we have the following parameters: 0 for the weight, 0 for the value, the maximum number of boxes to be used is passed as a parameter to the script (or, failing a parameter, defaulted to 5), an empty string for the list of boxes, &ldquo;A&rdquo; for the last box used, and the list of box colors.</p>
<p>The recursion base case (where recursion should stop) is reached when the current weight exceed 15 or when the number of available boxes left reaches 0.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">use</span> v6;

constant %boxes <span style="color:#f92672">=</span> (
    <span style="color:#e6db74">&#34;R&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>,  val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>  },
    <span style="color:#e6db74">&#34;B&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>,  val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>  },
    <span style="color:#e6db74">&#34;G&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>,  val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span>  },
    <span style="color:#e6db74">&#34;Y&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">12</span>, val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">4</span>  },
    <span style="color:#e6db74">&#34;P&#34;</span> <span style="color:#f92672">=&gt;</span> { <span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">4</span>,  val <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">10</span> },
);

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">MAIN</span> (UInt $start-nb-boxes = 5) {
    <span style="color:#66d9ef">my</span> @boxes <span style="color:#f92672">=</span> keys %boxes;
    <span style="color:#66d9ef">my</span> $<span style="color:#960050;background-color:#1e0010">*</span>max<span style="color:#f92672">-</span>val <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">my</span> $<span style="color:#960050;background-color:#1e0010">*</span>max<span style="color:#f92672">-</span>boxes <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
    try<span style="color:#f92672">-</span>one(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, $start<span style="color:#f92672">-</span>nb<span style="color:#f92672">-</span>boxes, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;A&#34;</span>, @boxes);
    say <span style="color:#e6db74">&#34;Max: $*max-val, Boxes:  $*max-boxes&#34;</span>;
    say now <span style="color:#f92672">-</span> <span style="color:#66d9ef">INIT</span> now;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">try</span>-one ($cur-weight, $cur-val, $num-boxes, $boxes-used, $last-box-used, @boxes-left) {
    <span style="color:#66d9ef">if</span> $cur<span style="color:#f92672">-</span>val <span style="color:#f92672">&gt;</span> $<span style="color:#960050;background-color:#1e0010">*</span>max<span style="color:#f92672">-</span>val {
        $<span style="color:#960050;background-color:#1e0010">*</span>max<span style="color:#f92672">-</span>val <span style="color:#f92672">=</span> $cur<span style="color:#f92672">-</span>val;
        $<span style="color:#960050;background-color:#1e0010">*</span>max<span style="color:#f92672">-</span>boxes <span style="color:#f92672">=</span> $boxes<span style="color:#f92672">-</span>used;
    }
    <span style="color:#66d9ef">for</span> @boxes<span style="color:#f92672">-</span>left <span style="color:#f92672">-&gt;</span> $box {
        <span style="color:#66d9ef">next</span> <span style="color:#66d9ef">if</span> $box <span style="color:#f92672">lt</span> $last<span style="color:#f92672">-</span>box<span style="color:#f92672">-</span>used;
        <span style="color:#66d9ef">my</span> $new<span style="color:#f92672">-</span>cur<span style="color:#f92672">-</span>weight <span style="color:#f92672">=</span> $cur<span style="color:#f92672">-</span>weight <span style="color:#f92672">+</span> %boxes{$box}{<span style="color:#e6db74">&#39;w&#39;</span>};
        <span style="color:#66d9ef">next</span> <span style="color:#66d9ef">if</span> $new<span style="color:#f92672">-</span>cur<span style="color:#f92672">-</span>weight <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">15</span> <span style="color:#f92672">or</span> $num<span style="color:#f92672">-</span>boxes <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
        <span style="color:#66d9ef">my</span> @new<span style="color:#f92672">-</span>boxes<span style="color:#f92672">-</span>left <span style="color:#f92672">=</span> grep { $_ <span style="color:#f92672">ne</span> $box}, @boxes<span style="color:#f92672">-</span>left;
        <span style="color:#66d9ef">my</span> $new<span style="color:#f92672">-</span>box<span style="color:#f92672">-</span>used <span style="color:#f92672">=</span> $boxes<span style="color:#f92672">-</span>used ?? $boxes<span style="color:#f92672">-</span>used <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;-$box&#34;</span> <span style="color:#f92672">!!</span> $box;
        try<span style="color:#f92672">-</span>one $new<span style="color:#f92672">-</span>cur<span style="color:#f92672">-</span>weight, $cur<span style="color:#f92672">-</span>val <span style="color:#f92672">+</span> %boxes{$box}{<span style="color:#e6db74">&#39;val&#39;</span>}, $num<span style="color:#f92672">-</span>boxes <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, $new<span style="color:#f92672">-</span>box<span style="color:#f92672">-</span>used, $box, @new<span style="color:#f92672">-</span>boxes<span style="color:#f92672">-</span>left;
    }
}
</code></pre></div><p>This are some examples of output:</p>
<pre><code>$ perl6 boxes.p6
Max: 15, Boxes:  B-G-P-R
0.0099724

$ perl6 boxes.p6 4
Max: 15, Boxes:  B-G-P-R
0.0209454

$ perl6 boxes.p6 3
Max: 14, Boxes:  B-G-P
0.01895075

$ perl6 boxes.p6 2
Max: 12, Boxes:  B-P
0.0109711
</code></pre>
<h3 id="a-solution-taking-advantage-of-rakus-built-in-features">A Solution Taking Advantage of Raku&rsquo;s Built-in Features</h3>
<p>As mentioned earlier, the recursive solution above was inspired by our Perl 5 solution.</p>
<p>But Raku offers the built-in <a href="https://docs.raku.org/routine/combinations">combinations</a> routine that can make our program shorter and simpler. It will return a list (really a <a href="https://docs.raku.org/type/Seq">Seq</a>) of all possible combinations of the input list or array. You can even specify the number of items, or, even better, a range for the numbers of items in each combinations; this will enable us to answer the bonus question by specifying the maximal number of boxes, and also to remove from the output the empty list (which may otherwise generate errors or warnings). The <code>find-best</code> subroutine does most of the work: the first statement populates a <code>@valid-candidates</code> array with combinations not exceeding the maximal weight, along with their total respective values, and the next statement returns the maximal value combination.</p>
<pre><code>use v6;

constant %boxes = (
    &quot;R&quot; =&gt; { &quot;w&quot; =&gt; 1,  val =&gt; 1  },
    &quot;B&quot; =&gt; { &quot;w&quot; =&gt; 1,  val =&gt; 2  },
    &quot;G&quot; =&gt; { &quot;w&quot; =&gt; 2,  val =&gt; 2  },
    &quot;Y&quot; =&gt; { &quot;w&quot; =&gt; 12, val =&gt; 4  },
    &quot;P&quot; =&gt; { &quot;w&quot; =&gt; 4,  val =&gt; 10 },
);
sub MAIN (UInt $max-nb = 5) {
    my ($best, $max) = find-best %boxes.keys.combinations: 1..$max-nb;
    say &quot;Max: $max; &quot;, $best;
}
sub find-best (@candidates) {
    my @valid-candidates = gather for @candidates -&gt; $cand {
        take [ $cand, $cand.map({ %boxes{$_}{'val'}}).sum ]
            if $cand.map({ %boxes{$_}{'w'}}).sum &lt;= 15;
    }
    return  @valid-candidates.max({$_[1]});
}
</code></pre>
<p>The output is the same as before:</p>
<pre><code>$ perl6 boxes2.p6
Max: 15; (R G B P)

$ perl6 boxes2.p6 5
Max: 15; (R P B G)

$ perl6 boxes2.p6 4
Max: 15; (B G P R)

$ perl6 boxes2.p6 3
Max: 14; (B G P)

$ perl6 boxes2.p6 2
Max: 12; (P G)
</code></pre>
<p>The actual code is about twice shorter with the <code>combinations</code> routine.</p>
<h2 id="alternative-solutions-1">Alternative Solutions</h2>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/arne-sommer/perl6/ch-2.p6">Arne Sommer</a> also used the <code>combinations</code> built-in routine, but with a slightly different, more procedural, approach:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">for</span> @boxes<span style="color:#f92672">.</span>combinations<span style="color:#f92672">.</span>grep(<span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;</span> <span style="color:#f92672">*.</span>elems <span style="color:#f92672">&lt;=</span> $boxcount) <span style="color:#f92672">-&gt;</span> @list
{
  <span style="color:#66d9ef">my</span> $key    <span style="color:#f92672">=</span> @list<span style="color:#f92672">.</span>join;

  <span style="color:#66d9ef">next</span> <span style="color:#66d9ef">if</span> %w{$key}<span style="color:#f92672">.</span>defined;

  <span style="color:#66d9ef">my</span> $weight <span style="color:#f92672">=</span> @list<span style="color:#f92672">.</span>map({ %weight{$_} })<span style="color:#f92672">.</span>sum;
  <span style="color:#66d9ef">my</span> $value  <span style="color:#f92672">=</span> @list<span style="color:#f92672">.</span>map({ %value{$_}  })<span style="color:#f92672">.</span>sum;

  <span style="color:#66d9ef">if</span> $weight <span style="color:#f92672">&lt;=</span> $maxweight
  {
    %w{$key} <span style="color:#f92672">=</span> $weight;
    %v{$key} <span style="color:#f92672">=</span> $value;

    say <span style="color:#e6db74">&#34;{ @list } -&gt; $weight kg -&gt; £ $value&#34;</span> <span style="color:#66d9ef">if</span> $verbose;
  }
  <span style="color:#66d9ef">elsif</span> $verbose
  {
    say <span style="color:#e6db74">&#34;{ @list } -&gt; $weight kg -&gt; £ $value (&gt; $maxweight kg; ignored)&#34;</span>;
  }
}
<span style="color:#66d9ef">my</span> $max <span style="color:#f92672">=</span> %v<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>max;
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/daniel-mita/perl6/ch-2.p6">Daniel Mita</a> also used the <code>combinations</code> built-in routine and made a very concise program using a data pipeline to solve the problem. Note that I originally tried to use a single data pipeline with <code>grep</code>, <code>map</code>, <code>sum</code> and <code>max</code>, but I did not succeed to get it to work properly (it tends to be more difficult that in Perl 5, because type mismatches get in the way), so I decided to change it to a <code>gather ... take</code> construct. So, I wish to congratulate Daniel for having succeeded to do it. Anyway, here it is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> @boxes <span style="color:#f92672">=</span> <span style="color:#f92672">&lt;</span>R B G Y P<span style="color:#f92672">&gt;.</span>map({ $_ <span style="color:#f92672">=&gt;</span> %<span style="color:#960050;background-color:#1e0010">(</span> :weight((<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">10</span>)<span style="color:#f92672">.</span>roll), :amount((<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">100</span>)<span style="color:#f92672">.</span>roll) ) });

<span style="color:#f92672">.</span>say <span style="color:#66d9ef">for</span> <span style="color:#f92672">|</span>@boxes, <span style="color:#e6db74">&#39;&#39;</span>;

<span style="color:#f92672">.</span>Hash<span style="color:#f92672">.</span>keys<span style="color:#f92672">.</span>say <span style="color:#66d9ef">for</span> @boxes
  <span style="color:#75715e"># Generate all possible combinations of boxes</span>
  <span style="color:#f92672">.</span>combinations(<span style="color:#ae81ff">1</span> <span style="color:#f92672">..</span> <span style="color:#960050;background-color:#1e0010">∞</span>)
  <span style="color:#75715e"># Grep the ones with valid weights</span>
  <span style="color:#f92672">.</span>grep(<span style="color:#f92672">*.</span>map(<span style="color:#f92672">*.</span>value<span style="color:#e6db74">&lt;weight&gt;</span>)<span style="color:#f92672">.</span>sum <span style="color:#960050;background-color:#1e0010">≤</span> <span style="color:#ae81ff">15</span>)
  <span style="color:#75715e"># Sort them by total value</span>
  <span style="color:#f92672">.</span>sort({ $_($<span style="color:#960050;background-color:#1e0010">^</span>b) <span style="color:#e6db74">&lt;=&gt;</span> $_($<span style="color:#960050;background-color:#1e0010">^</span>a) given <span style="color:#f92672">*.</span>map(<span style="color:#f92672">*.</span>value<span style="color:#e6db74">&lt;amount&gt;</span>)<span style="color:#f92672">.</span>sum });
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/simon-proctor/perl6/ch-2.p6">Simon Proctor</a> created a very simple <code>box</code> class:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">class Box {
    has Int $<span style="color:#960050;background-color:#1e0010">.</span>weight;
    has Int $<span style="color:#960050;background-color:#1e0010">.</span>worth;

    method gist { <span style="color:#e6db74">&#34;{$!weight}kg worth £{$!worth}&#34;</span> }
}
</code></pre></div><p>Note the definition of a <code>gist</code> method to pretty print <code>Box</code> objects: this works because the <code>say</code> routine invokes the <code>gist</code> method to format its output; therefore, if you redefine <code>gist</code> in a class, then <code>say</code> will use the redefined <code>gist</code> method on any object of that class to obtain the string representation of such objects.</p>
<p>Otherwise, I extend my congratulations to Simon, who also wrote a single data pipeline to do the bulk of the work:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> @options <span style="color:#f92672">=</span> @boxes<span style="color:#f92672">.</span>combinations()<span style="color:#f92672">.</span>grep( <span style="color:#f92672">*.</span>elems <span style="color:#f92672">&lt;=</span> $max<span style="color:#f92672">-</span>boxes )<span style="color:#f92672">.</span>grep( { ([<span style="color:#f92672">+</span>] $_<span style="color:#f92672">.</span>map( <span style="color:#f92672">*.</span>weight )) <span style="color:#f92672">&lt;=</span> $max<span style="color:#f92672">-</span>weight } )<span style="color:#f92672">.</span>sort( { ( [<span style="color:#f92672">+</span>] $<span style="color:#960050;background-color:#1e0010">^</span>b<span style="color:#f92672">.</span>map( <span style="color:#f92672">*.</span>worth ) ) <span style="color:#f92672">cmp</span> ( [<span style="color:#f92672">+</span>] $<span style="color:#960050;background-color:#1e0010">^</span>a<span style="color:#f92672">.</span>map( <span style="color:#f92672">*.</span>worth ) ) } );
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/kevin-colyer/perl6/ch-2.p6">Kevin Colyer</a> also created a very simple <code>box</code> class to manage the colors, weights and values:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">class box {
    has Str $<span style="color:#960050;background-color:#1e0010">.</span>colour;
    has Int $<span style="color:#960050;background-color:#1e0010">.</span>weight;
    has Int $<span style="color:#960050;background-color:#1e0010">.</span>amount;
}
</code></pre></div><p>He then used the <code>combinations</code> built-in routine to create all possible box combinations, filtered out combinations with too many boxes or overweight combinations and finally sorted the combinations to retain the largest value:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">knapsack</span>(@combinations,@boxes,$max_weight,$max_boxes) {
    <span style="color:#66d9ef">my</span> @cands<span style="color:#f92672">=</span> gather <span style="color:#66d9ef">for</span> @combinations <span style="color:#f92672">-&gt;</span> @c {

        <span style="color:#75715e"># prune combinations with more than max boxes</span>
        <span style="color:#66d9ef">next</span> <span style="color:#66d9ef">unless</span> @c<span style="color:#f92672">.</span>elems <span style="color:#f92672">&lt;=</span> $max_boxes;

        <span style="color:#66d9ef">my</span> $w<span style="color:#f92672">=</span> @boxes[@c]<span style="color:#f92672">&gt;&gt;.</span>weight<span style="color:#f92672">.</span>sum;

        <span style="color:#75715e"># prune overweight combinations</span>
        <span style="color:#66d9ef">next</span> <span style="color:#66d9ef">unless</span> $w <span style="color:#f92672">&lt;=</span> $max_weight;

        <span style="color:#75715e"># cache for later</span>
        <span style="color:#66d9ef">my</span> %wv<span style="color:#f92672">=</span> comb <span style="color:#f92672">=&gt;</span> @c, w <span style="color:#f92672">=&gt;</span> $w, v <span style="color:#f92672">=&gt;</span> @boxes[@c]<span style="color:#f92672">&gt;&gt;.</span>amount<span style="color:#f92672">.</span>sum;
        take %wv;
    }
    <span style="color:#75715e"># sort in descending order - highest value first.</span>
    @cands<span style="color:#f92672">.=</span>sort({$<span style="color:#960050;background-color:#1e0010">^</span>a<span style="color:#e6db74">&lt;v&gt;</span> <span style="color:#f92672">&lt;=</span> $<span style="color:#960050;background-color:#1e0010">^</span>b<span style="color:#e6db74">&lt;v&gt;</span>});

    <span style="color:#66d9ef">return</span> @cands[<span style="color:#ae81ff">0</span>];
}
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/ulrich-rieke/perl6/ch-2.p6">Ulrich Rieke</a> also used the <code>combinations</code> built-in routine several times:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> @combis1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;RBGYP&#34;</span><span style="color:#f92672">.</span>comb<span style="color:#f92672">.</span>combinations( <span style="color:#ae81ff">4</span> )<span style="color:#f92672">.</span>Array ;
<span style="color:#66d9ef">my</span> @combis2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;RBGYP&#34;</span><span style="color:#f92672">.</span>comb<span style="color:#f92672">.</span>combinations( <span style="color:#ae81ff">3</span> )<span style="color:#f92672">.</span>Array ;
<span style="color:#66d9ef">my</span> @combis3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;RBGYP&#34;</span><span style="color:#f92672">.</span>comb<span style="color:#f92672">.</span>combinations( <span style="color:#ae81ff">2</span> )<span style="color:#f92672">.</span>Array ;
<span style="color:#66d9ef">for</span> @combis1 <span style="color:#f92672">-&gt;</span> $sublist {
  @results<span style="color:#f92672">.</span>push( computeSubsums( $sublist<span style="color:#f92672">.</span>join )) ;
}
<span style="color:#66d9ef">for</span> @combis2 <span style="color:#f92672">-&gt;</span> $sublist {
  @results<span style="color:#f92672">.</span>push( computeSubsums( $sublist<span style="color:#f92672">.</span>join )) ;
}
<span style="color:#66d9ef">for</span> @combis3 <span style="color:#f92672">-&gt;</span> $sublist {
  @results<span style="color:#f92672">.</span>push( computeSubsums( $sublist<span style="color:#f92672">.</span>join )) ;
}
<span style="color:#66d9ef">my</span> @withinWeight <span style="color:#f92672">=</span> @results<span style="color:#f92672">.</span>grep( { $_[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">15</span> }) ;
<span style="color:#66d9ef">my</span> @sorted <span style="color:#f92672">=</span> @withinWeight<span style="color:#f92672">.</span>sort( {$<span style="color:#960050;background-color:#1e0010">^</span>b[<span style="color:#ae81ff">2</span>] <span style="color:#e6db74">&lt;=&gt;</span> $<span style="color:#960050;background-color:#1e0010">^</span>a[<span style="color:#ae81ff">2</span>] } ) ;
</code></pre></div><p>It seems that Ulrich did not know that you can pass a range to the <a href="https://docs.raku.org/routine/combinations">combinations</a> routine, as shown here under the REPL (some output combinations omitted for brevity):</p>
<pre><code>&gt; say &quot;RBGYP&quot;.comb.combinations: 2..4;
((R B) (R G) ... (G Y) (G P) (Y P) (R B G) (R B Y) ... (R G Y P) (B G Y P))
</code></pre>
<p>I believe this could have made his code shorter and simpler.</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/javier-luque/perl6/ch-2.p6">Javier Luque</a> did not use the <code>combinations</code> built-in routine and, as a result, his <code>knapsack</code> subroutine is (like my initial recursive solution) significantly longer and more complex than many other solutions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl6" data-lang="perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">knapsack</span> (%boxes, Int $max_weight, Num() $max_boxes) {
    <span style="color:#66d9ef">my</span> $total_weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">my</span> $total_boxes  <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">my</span> $total_amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">my</span> $set_of_boxes <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;

    <span style="color:#66d9ef">for</span> %boxes<span style="color:#f92672">.</span>keys<span style="color:#f92672">.</span>sort(<span style="color:#f92672">&amp;</span>sort<span style="color:#f92672">-</span>value<span style="color:#f92672">-</span>weight) <span style="color:#f92672">-&gt;</span> $key {
        <span style="color:#66d9ef">my</span> $box <span style="color:#f92672">=</span> %boxes<span style="color:#f92672">.</span>{$key};

        <span style="color:#75715e"># While there is space or weight left</span>
        <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
            <span style="color:#75715e"># Check for space or weight</span>
            <span style="color:#66d9ef">last</span> <span style="color:#66d9ef">unless</span>
                $total_weight <span style="color:#f92672">+</span> $box<span style="color:#f92672">.</span>{<span style="color:#e6db74">&#39;weight&#39;</span>} <span style="color:#f92672">&lt;=</span>
                $max_weight;

            <span style="color:#66d9ef">last</span> <span style="color:#66d9ef">unless</span>
                <span style="color:#f92672">!</span>$max_boxes <span style="color:#f92672">||</span>
                ($max_boxes <span style="color:#f92672">&amp;&amp;</span> $total_boxes <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;=</span>
                 $max_boxes);

            $total_boxes<span style="color:#f92672">++</span>;
            $set_of_boxes <span style="color:#f92672">~=</span> $key;
            $total_weight <span style="color:#f92672">+=</span> $box<span style="color:#f92672">.</span>{<span style="color:#e6db74">&#39;weight&#39;</span>};
            $total_amount <span style="color:#f92672">+=</span> $box<span style="color:#f92672">.</span>{<span style="color:#e6db74">&#39;amount&#39;</span>};
        }
    }

    say <span style="color:#e6db74">&#39;Max weight: &#39;</span> <span style="color:#f92672">~</span> $max_weight <span style="color:#f92672">~</span>
        <span style="color:#e6db74">&#39;, max boxes: &#39;</span> <span style="color:#f92672">~</span> $max_boxes <span style="color:#f92672">~</span>
        <span style="color:#e6db74">&#39;. Boxes in knapsack: &#39;</span> <span style="color:#f92672">~</span>
        $set_of_boxes <span style="color:#f92672">~</span>
        <span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">~</span> $total_weight <span style="color:#f92672">~</span> <span style="color:#e6db74">&#39;kg &#39;</span> <span style="color:#f92672">~</span>
        <span style="color:#e6db74">&#39;£&#39;</span> <span style="color:#f92672">~</span> $total_amount;
}
</code></pre></div><p>Also, Javier uses a 22-code-line subroutine (not shown here) for the purpose of sorting the boxes by values and then by weight, where as it can be done in just one statement, as shown in this example under the Raku REPL implementing a descending order sort by value and then by weight:</p>
<pre><code>&gt; my %boxes = (
*     R =&gt; { weight =&gt; 1,  amount =&gt; 1  },
*     B =&gt; { weight =&gt; 1,  amount =&gt; 2  },
*     G =&gt; { weight =&gt; 2,  amount =&gt; 2  },
*     Y =&gt; { weight =&gt; 12, amount =&gt; 4  },
*     P =&gt; { weight =&gt; 4,  amount =&gt; 10 },
* );
{B =&gt; {amount =&gt; 2, weight =&gt; 1}, G =&gt; {amount =&gt; 2, weight =&gt; 2}, P =&gt; {amount =&gt; 10, weight =&gt; 4}, R =&gt; {amount =&gt; 1, weight =&gt; 1}, Y =&gt; {amount =&gt; 4, weight =&gt; 12}}
&gt; my @sorted-keys = %boxes.keys.sort({%boxes{$^b}&lt;amount&gt; &lt;=&gt; %boxes{$^a}&lt;amount&gt; || %boxes{$^b}&lt;weight&gt; &lt;=&gt; %boxes{$^a}&lt;weight&gt;});
[P Y G B R]
</code></pre>
<p>And, by the way, I&rsquo;m not entirely convinced it is really useful to sort the boxes in such a way.</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/roger-bell-west/perl6/ch-2.p6">Roger Bell West</a> also did not use the <code>combinations</code> built-in routine and his solution is also quite long. This is the part of his code doing the bulk of the work:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">for</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>(@k<span style="color:#f92672">.</span>elems)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">-&gt;</span> $map {
  <span style="color:#66d9ef">my</span> $b<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">my</span> $v<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">my</span> $w<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">for</span> (<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span>@k<span style="color:#f92672">.</span>end) <span style="color:#f92672">-&gt;</span> $ci {
    <span style="color:#66d9ef">if</span> ($map <span style="color:#f92672">+&amp;</span> @v[$ci]) {
      $v <span style="color:#f92672">+=</span> %box{@k[$ci]}{<span style="color:#e6db74">&#39;v&#39;</span>};
      $w <span style="color:#f92672">+=</span> %box{@k[$ci]}{<span style="color:#e6db74">&#39;w&#39;</span>};
      $b<span style="color:#f92672">++</span>;
    }
    <span style="color:#66d9ef">if</span> ($b<span style="color:#f92672">&gt;</span>$maxb <span style="color:#f92672">||</span> $w<span style="color:#f92672">&gt;</span>$maxw) {
      $v<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>;
      <span style="color:#66d9ef">last</span>;
    }
  }
  <span style="color:#66d9ef">if</span> ($v<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>) {
    <span style="color:#66d9ef">if</span> ($v<span style="color:#f92672">&gt;</span>$bestv <span style="color:#f92672">||</span> ($v<span style="color:#f92672">==</span>$bestv <span style="color:#f92672">&amp;&amp;</span> $w<span style="color:#f92672">&gt;</span>$maxw)) {
      $bestv<span style="color:#f92672">=</span>$v;
      $bestw<span style="color:#f92672">=</span>$w;
      $bestid<span style="color:#f92672">=</span>$map;
    }
  }
}

<span style="color:#66d9ef">for</span> (<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span>@k<span style="color:#f92672">.</span>end) <span style="color:#f92672">-&gt;</span> $ci {
  <span style="color:#66d9ef">if</span> ($bestid <span style="color:#f92672">+&amp;</span> @v[$ci]) {
    <span style="color:#66d9ef">print</span> @k[$ci],<span style="color:#e6db74">&#34;\n&#34;</span>;
  }
}
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-036/ruben-westerberg/perl6/ch-2.p6">Ruben Westerberg</a> also did not use the <code>combinations</code> routine, but he nonetheless succeeded to keep his code relatively small. I can see several interesting ideas in his code. First, he uses hash slices to populate his data structure:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> %boxes;
%boxes{<span style="color:#f92672">&lt;</span>R B G Y P<span style="color:#f92672">&gt;</span>}<span style="color:#f92672">=</span>({c<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">1</span>,w<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">1</span>,},{c<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">2</span>, w<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">1</span>},{c<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">2</span>,w<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">2</span>},{c<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">4</span>,w<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">12</span>},{c<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">10</span>,w<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">4</span>});
</code></pre></div><p>Then, his program sorts the data by the value/weight ratio:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#f92672">.</span>value<span style="color:#e6db74">&lt;r&gt;</span><span style="color:#f92672">=.</span>value<span style="color:#e6db74">&lt;c&gt;</span><span style="color:#f92672">/.</span>value<span style="color:#e6db74">&lt;w&gt;</span> <span style="color:#66d9ef">for</span> %boxes;
<span style="color:#66d9ef">my</span> @b<span style="color:#f92672">=</span> %boxes<span style="color:#f92672">.</span>keys<span style="color:#f92672">.</span>sort( <span style="color:#f92672">-&gt;</span>$a,$b { %boxes{$b}<span style="color:#e6db74">&lt;r&gt;</span> <span style="color:#e6db74">&lt;=&gt;</span> %boxes{$a}<span style="color:#e6db74">&lt;r&gt;</span>});
</code></pre></div><p>It&rsquo;s a clever idea in terms of possible optimization, but, again, I&rsquo;m not entirely sure that sorting the data in this way is really useful here if you want to test all possible combinations (it&rsquo;s a bit late on Sunday evening, and I don&rsquo;t have time to really test because I want to submit this review in time for Mohammad to be able to announce it tonight ot tomorrow morning).</p>
<p>Otherwise, his loop to find the best knapsack is quite concise:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">while</span> (@b) {
    state $rem<span style="color:#f92672">=</span>$limit;
    <span style="color:#66d9ef">my</span> $tmp<span style="color:#f92672">=</span>$rem <span style="color:#f92672">-</span> %boxes{@b[<span style="color:#ae81ff">0</span>]}<span style="color:#e6db74">&lt;w&gt;</span>;
    <span style="color:#66d9ef">if</span> $tmp <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> {
        @b<span style="color:#f92672">.</span>shift;
        <span style="color:#66d9ef">next</span>;
    }
    @selected<span style="color:#f92672">.</span>push: @b[<span style="color:#ae81ff">0</span>];
    $rem<span style="color:#f92672">=</span>$tmp;
}
</code></pre></div><hr>
<h3 id="see-also">SEE ALSO</h3>
<p>Three blog posts (besides mine) this time:</p>
<p>Arne Sommer: <a href="https://raku-musings.com/vin-knapsack.html;">https://raku-musings.com/vin-knapsack.html;</a></p>
<p>Kevin Colyer wrote his first blog on the Perl Weekly Challenge: <a href="https://raku-musings.com/vin-knapsack.html;">https://raku-musings.com/vin-knapsack.html;</a></p>
<p>Javier Luque: <a href="https://perlchallenges.wordpress.com/2019/11/25/perl-weekly-challenge-036/">https://perlchallenges.wordpress.com/2019/11/25/perl-weekly-challenge-036/</a>.</p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>Please let me know if I forgot any of the challengers or if you think my explanation of your code misses something important (send me an e-mail or just raise an issue against this GitHub page).</p>
<p>If you want to participate to the Perl Weekly Challenge, please connect to <a href="https://perlweeklychallenge.org/">this site</a>.</p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h2>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->



<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        2020
                    </span> PerlWeeklyChallenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" rel="noreferrer" rel="noreferrer" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" rel="noreferrer" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.nomtimes.co.uk/site/shop.do?cref=PerlBooks" title="Free Perl Books" rel="noreferrer" target="_blank">
                            <img src="/images/NomTimes.jpg" style="width:22px; height: 18px;" alt=""/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://perlweeklychallenge.org/plugins/jQurey/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.form.min.js"></script>
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://perlweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://perlweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/chart.js"></script>
<!-- wow js -->
<script src="https://perlweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://perlweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://perlweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-136524905-1', 'auto');
    ga('send', 'pageview');
</script>
</body>

</html>

